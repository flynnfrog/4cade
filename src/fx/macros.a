!ifndef _HGRMACROS_ {
         !source "src/macros.a"

!macro HGR_CALC {
         asl
         tax
         and   #$F0
         bpl   @calc1
         ora   #$05
@calc1   bcc   @calc2
         ora   #$0A
@calc2   asl
         asl
         sta   $26
         txa
         and   #$0E
         adc   #$10
         asl   $26
         rol
         sta   $27
         eor   #$60
         sta   $3d
         lda   $26
         sta   $3c
}

!macro HGR_INC_WITHIN_BLOCK {
         lda   $27
         adc   #$04
         sta   $27
         eor   #$60
         sta   $3d
}

!macro RESET_HGR_CALC {
         lda   $27
         sec
         sbc   #$20
         sta   $27
         eor   #$60
         sta   $3d
}

!macro SWITCH_TO_MASKS .source, .copy {
         sty   $00
         +LDADDR .source
         jsr   SetSourceMask
         +LDADDR .copy
         jsr   SetCopyMask
         ldy   $00
}

!macro INIT_MASKS .source, .copy {
         +SWITCH_TO_MASKS .source, .copy
         jsr   BuildSourceMaskFromCopyMask
}

_HGRMACROS_=*
}
